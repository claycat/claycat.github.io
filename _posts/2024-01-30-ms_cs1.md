---
title: 운영체제 면접대비
date: 2024-01-24 12:00:00 +/-TTTT
categories: [Interview]
comments: true
tags: 면접
---

# 운영체제 혼내주기

기술면접 경험이 많지는 않지만, 개인적으로 질문에 대답은 해당 질문에 답변하면서 **어느정도 예상할 수 있는** 꼬리질문의 여지를 남기는 대답이 가장 좋다고 생각한다

실제 면접을 본다고 생각하고 흐름을 한번 정리해보는 포스팅이다.


# 프로세스 vs 스레드

> **“*프로세스와 스레드의 차이에 대해서 설명해주세요 “***
{: .prompt-tip }


### 프로그램

만약 면졉에서 해당 질문을 받았다면, 프로그램이 무엇인지부터 설명해나가는 것이 좋을것이다.

**프로그램이란 디스크에 저장되어있는 실행가능한 파일로**, 코드 또는 명령어들의 집합이 담겨져있다.

프로그램을 실행하면 디스크에 있는 명령어들은 메모리에 로드되게 되고 이때 이것은 **프로세스가** 된다

> **“그렇다면 프로세스는 무엇을 갖고있나요?”**
{: .prompt-tip }

프로세스는 프로그램을 실행하기 위한 코드 뿐만 아니라, 코드를 실행하기 위해서 운영체제로부터 받는 시스템 자원 또한 갖고 있다. 

예를 들면, Process Register, Program Counter, Stack Pointer, Memory Page 등등 

중요한것은 프로세스는 서로 **격리**되어있다는것이다. 각각 별도의 메모리 공간을 할당받고, 하나가 불량으로 인해 실패하더라도 다른 프로세스에 영향을 주지 않는다

> **“스레드는 무엇인가요?”**
{: .prompt-tip }

그렇다면 스레드는 무엇인가?

왜 스레드는 프로세스 내부의 실행 단위이다

프로세스는 하나의 메인 스레드를 보유하고, 여러개의 추가적인 스레드를 보유할 수 있다.

각 스레드는 저마다의 stack, program counter, register 등을 보유하고 있지만,
코드, 데이터, 힙 메모리 영역은 공유하고 있다. 

개별적인 스택 영역을 보유한다는 의미는 각 스레드가 저마다의 독립적인 실행 환경을 보유한다는 의미이다

> **“멀티스레딩과 멀티프로세싱의 차이점은 그러면 무엇인가요? 어떤게 더 빠를까요?”**
{: .prompt-tip }

결국 멀티스레딩이라는건 하나의 프로세스 안에서 수행하는 병렬 작업이고,

멀티프로세싱은 여러개의 프로세스들을 별도의 프로세스에서 병렬로 수행하는것이다 

둘간의 속도를 직접적으로 비교하는것은 의미가 없다. 결국 요구사항의 환경 차이로부터 속도의 차이는 발생한다.
둘의 차이를 생각해보자. 스레드들은 힙 메모리 영역을 공유하는것이 주요한 차이이다.

따라서 몇가지 상황을 가정하자면, 

- 태스크가 강결합되거나 태스크간 통신이 많이 필요하다면 스레드가 효율적일 수 있다(IPC 오버헤드)
- 동일한 메모리에 자주 접근하거나 업데이트를 수행한다면 lock 오버헤드로 프로세스가 효율적일 수 있다

> **“자바에서 Thread 객체를 만들 수 있고, 
C에서는 pthread 등을 이용하여 스레드를 만들 수 있습니다.
이것들과 실제 하드웨어의 스레드는 어떤 관계인가요?”**
{: .prompt-tip }

서로 1:1 매칭 (동일한) 개념은 아닙니다.

언어의 스레드 객체는 어디까지나 소프트웨어의 영역이고 하드웨어 스레드와의 관계는 운영체제의 스케쥴러가 맺어줍니다

---

# PCB & Context Switching

> **“동시성(Concurrency) 와 병렬성(Parallelism)에 대해서 설명해주세요”**
{: .prompt-tip }

병렬성은 여러개의 물리적인 하드웨어에서 여러개의 작업을 동시에 처리하는것이고,

동시성은 하나의 하드웨어에서 여러개의 프로그램들을 동시에 수행하는것 처럼 보인다

> **“그렇다면 싱글코어 컴퓨터에서 어떻게 멀티프로세싱을 수행하나요?”**
{: .prompt-tip }

하나의 프로세서가 존재하더라도 짧은 time slice 안에 여러개의 프로세스를 번갈아가면서 수행하면 우리에게는 동시에 여러개의 프로세스가 수행되는것처럼  보인다.

> **“하나의 프로세스에서 다른 프로세스로 어떻게 전환할 수 있나요?”**
{: .prompt-tip }

짧은 시간 안에 프로세스를 전환하기 위해서는 상태를 보존하는 자료구조가 필요한데, 이를 PCB(Process Controll Block) 이라고 부르며, 전환하는 행위를 Context Switching 이라고 부른다.

PCB 내부에는 프로세스의 상태를 저장하는 다양한 정보가 들어있습니다 (program counter, register, pid, …)

해당 PCB를 이용해 다른 프로세스로 전환하고 다시 돌아왔을 때 프로세스의 상태를 복구시켜준다

> **“Context Switch 가 그러면 어떨 때 일어나나요?”**
{: .prompt-tip }

배정된 time slice가 만료되거나, 프로세스의 상태를 변경시키는 IO작업의 대기, 또는 우선순위가 높은 작업의 출현 등으로 인해 일어날 수 있습니다

> **“Context Switch가 일어나면 현재 상태는 어떻게 저장되나요?”**
{: .prompt-tip }

[https://stackoverflow.com/a/68055967](https://stackoverflow.com/a/68055967)

프로세스의 진행 중 스위칭이 일어날 경우 현재의 실행 컨텍스트는 (프로세스의 상태나 프로그램 카운터) 커널 스택에 저장됩니다 PID등 프로세스에 관련된 정보는 PCB에 저장됩니다

- PCB와 커널 스택 둘다 Context Switch 시에 필요한 정보를 담고 있다.
어떤 값을 들고있는지는 OS마다 다르고, 정확하게 정할 수는 없다.
- PCB는 일반적으로 Kernel Stack 내부에 존재한다

> **“그렇다면 스레드에도 PCB가 존재하나요?”**
{: .prompt-tip }

PCB의 명칭상 스레드에 PCB가 존재한다고는 말할 수 없지만, TCB라는 유사한 저장소가 존재한다

PCB와 유사하게 stack pointer, register 등 TCB에도 스레드의 상태를 기록하는 정보들이 존재하며, 프로세스보다는 작은 규모이다. 

> **“Kernel Level Thread 와 User Level Thread 의 차이는 무엇인가요?”**
{: .prompt-tip }

[https://stackoverflow.com/a/59634931](https://stackoverflow.com/a/59634931)

인터넷에 정확한 설명이 매우 부족한 부분인데, 간혹 나오는것같아 첨부한다

Kernel을 동작시키는 스레드 != Kernel 스레드

원점으로 돌아가보자. 하나의 코어를 갖고 있는 시스템에서 커널은 어떤 작업을 하는가?

여러개의 스레드가 연속적으로 context switching을 수행해주는걸 관리해준다.

Kernel 스레드는 어디까지나 이 개념을 조금 확장한것일뿐이다.

하나의 프로세스는 하나의 커널 스레드를 보유한 상태에서 시작한다. 즉, 싱글 스레드 앱이라면 모든 작업이 커널 스레드에서 수행된다. 당연하게도 PCB는 여기서 관리한다

하지만 프로세스를 여러개의 유저 스레드라는 일종의 유사 스레드로 실행될 수 있다.

일반적으로 라이브러리 등을 통해 생성되는 유저 스레드는 OS에서 관리하는 실제 스레드와는 다른 유사 스레드이다. 해당 유저 스레드의 스케쥴링은 라이브러리의 정책에 따라 관리되며 커널은 해당 프로세스의 분기에 대해서 전혀 알지 못한다 (하나의 프로세스로 볼 뿐)